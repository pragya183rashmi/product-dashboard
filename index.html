<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mongoose Product Manager (Simulated)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and overall feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* Light background */
        }
        .container-bg {
            background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%); /* Blue/Violet Gradient */
            color: white;
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        /* Custom scrollbar for product list */
        #productList::-webkit-scrollbar {
            width: 6px;
        }
        #productList::-webkit-scrollbar-thumb {
            background-color: #6d28d9;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <div class="max-w-6xl mx-auto">
        <!-- Main Header Card -->
        <header class="container-bg mb-8">
            <h1 class="text-3xl sm:text-4xl font-extrabold mb-1">
                Product Database Dashboard
            </h1>
            <p class="text-indigo-200">
                
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: CRUD Form -->
            <div class="lg:col-span-1">
                <div id="formCard" class="card p-6">
                    <h2 id="formTitle" class="text-2xl font-semibold text-gray-800 mb-6">Create New Product</h2>

                    <form id="productForm" class="space-y-4">
                        <input type="hidden" id="productId">
                        
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="name" required placeholder="e.g., Quantum Processor"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        </div>
                        
                        <div>
                            <label for="price" class="block text-sm font-medium text-gray-700">Price ($)</label>
                            <input type="number" id="price" required step="0.01" min="0" placeholder="e.g., 499.99"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        </div>

                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="description" required placeholder="A brief description of the product..." rows="3"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"></textarea>
                        </div>

                        <button type="submit" id="submitButton"
                            class="w-full py-2 px-4 border border-transparent rounded-lg shadow-lg text-sm font-medium text-white 
                                   bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 
                                   transition duration-150 ease-in-out transform hover:scale-[1.01]">
                            <i class="fas fa-plus mr-2"></i> Save Product
                        </button>
                        <button type="button" id="cancelButton" style="display: none;"
                            class="w-full py-2 px-4 border border-transparent rounded-lg shadow-lg text-sm font-medium text-indigo-700 
                                   bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 
                                   transition duration-150 ease-in-out">
                            Cancel Update
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Product List -->
            <div class="lg:col-span-2">
                <div class="card p-6 h-full flex flex-col">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Product Catalog ($$Product.find()$$)</h2>
                    
                    <!-- Alert/Message Box -->
                    <div id="messageBox" class="p-3 text-sm rounded-lg mb-4 hidden transition-opacity duration-300" role="alert"></div>

                    <!-- Product List Container (Scrollable) -->
                    <div id="productList" class="space-y-4 flex-grow overflow-y-auto max-h-[80vh] lg:max-h-[70vh]">
                        <!-- Products will be rendered here -->
                        <p class="text-center text-gray-500 mt-8" id="loadingMessage">Loading products...</p>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <script>
        // --- 1. Database Simulation (In-Memory Array simulating a Mongoose Collection) ---
        let products = [];
        let nextId = 1;
        const MESSAGE_DURATION = 3000;

        /**
         * Product Schema and Model Simulation.
         * Mongoose-like operations are mapped to array functions.
         */
        class Product {
            constructor(name, price, description, id = nextId++) {
                this._id = id; // Simulating Mongoose's unique ID
                this.name = name;
                this.price = parseFloat(price);
                this.description = description;
                this.createdAt = new Date().toISOString();
                this.updatedAt = new Date().toISOString();
            }

            // Simulates product.save() for creation (POST /products)
            static create(data) {
                const newProduct = new Product(data.name, data.price, data.description);
                products.push(newProduct);
                return newProduct;
            }

            // Simulates Product.findByIdAndUpdate(id, update, { new: true }) (PUT /products/:id)
            static update(id, data) {
                const index = products.findIndex(p => p._id === id);
                if (index === -1) return null;

                const product = products[index];
                product.name = data.name;
                product.price = parseFloat(data.price);
                product.description = data.description;
                product.updatedAt = new Date().toISOString();
                products[index] = product; // Reassigning for clarity, though it's an object reference
                return product;
            }

            // Simulates Product.find() (GET /products)
            static find() {
                // Return a copy to simulate database fetching
                return [...products].sort((a, b) => b._id - a._id);
            }

            // Simulates Product.findByIdAndRemove(id) (DELETE /products/:id)
            static delete(id) {
                const initialLength = products.length;
                products = products.filter(p => p._id !== id);
                return products.length < initialLength; // true if deleted
            }
            
            // Simulates Product.findById(id)
            static findById(id) {
                return products.find(p => p._id === id);
            }
        }


        // --- 2. DOM Elements and Utility Functions ---
        const productForm = document.getElementById('productForm');
        const productListDiv = document.getElementById('productList');
        const formTitle = document.getElementById('formTitle');
        const submitButton = document.getElementById('submitButton');
        const cancelButton = document.getElementById('cancelButton');
        const messageBox = document.getElementById('messageBox');
        const loadingMessage = document.getElementById('loadingMessage');


        /** Shows a temporary success or error message. */
        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.style.opacity = '1';
            
            // Reset and apply classes based on type
            messageBox.className = 'p-3 text-sm rounded-lg mb-4 transition-opacity duration-300';
            
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'info') {
                messageBox.classList.add('bg-blue-100', 'text-blue-800');
            }
            messageBox.style.display = 'block';

            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => messageBox.style.display = 'none', 300); // Hide after transition
            }, MESSAGE_DURATION);
        }

        /** Clears the form and resets it to 'Create' mode. */
        function resetForm() {
            productForm.reset();
            document.getElementById('productId').value = '';
            formTitle.textContent = 'Create New Product';
            submitButton.textContent = 'Save Product';
            submitButton.classList.replace('bg-green-600', 'bg-indigo-600');
            submitButton.classList.replace('hover:bg-green-700', 'hover:bg-indigo-700');
            cancelButton.style.display = 'none';
        }


        // --- 3. CRUD Handlers ---

        /** Renders the list of products from the simulated database ($$Product.find()$$) */
        function renderProducts() {
            const productsData = Product.find();
            productListDiv.innerHTML = '';
            loadingMessage.style.display = 'none';

            if (productsData.length === 0) {
                productListDiv.innerHTML = '<p class="text-center text-gray-500 mt-8 p-4">The database is empty. Start by creating a new product!</p>';
                return;
            }

            productsData.forEach(product => {
                const productCard = document.createElement('div');
                // Use vibrant color palette and modern card style
                productCard.className = 'card p-4 border border-gray-100 hover:border-indigo-300 transition duration-150 ease-in-out flex justify-between items-start';
                productCard.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <p class="text-xs text-indigo-500 font-semibold mb-1">ID: ${product._id}</p>
                        <h3 class="text-lg font-bold text-gray-900 truncate">${product.name}</h3>
                        <p class="text-2xl font-extrabold text-green-600 my-1">$${product.price.toFixed(2)}</p>
                        <p class="text-sm text-gray-600 line-clamp-2">${product.description}</p>
                    </div>
                    <div class="flex space-x-2 ml-4 flex-shrink-0 mt-1">
                        <button onclick="handleEdit(${product._id})" 
                                class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition duration-150 transform hover:scale-105"
                                title="Update Product (Mongoose $$findByIdAndUpdate$$)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-7 1l4-4m-4 4l-4 4m8-4l-4-4" />
                            </svg>
                        </button>
                        <button onclick="handleDelete(${product._id})"
                                class="p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition duration-150 transform hover:scale-105"
                                title="Delete Product (Mongoose $$findByIdAndRemove$$)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.86 11.14A2 2 0 0116.14 20H7.86a2 2 0 01-1.98-1.86L5 7m5 4v6m4-6v6M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;
                productListDiv.appendChild(productCard);
            });
        }

        /** Handles Create and Update via form submission. */
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const id = document.getElementById('productId').value ? parseInt(document.getElementById('productId').value) : null;
            const name = document.getElementById('name').value.trim();
            const price = document.getElementById('price').value;
            const description = document.getElementById('description').value.trim();
            
            if (name === "" || price === "" || description === "") {
                showMessage("All fields are required.", 'error');
                return;
            }

            const productData = { name, price, description };

            if (id) {
                // UPDATE operation (Simulates product.save() after modification)
                const updatedProduct = Product.update(id, productData);
                if (updatedProduct) {
                    showMessage(`Product "${updatedProduct.name}" updated successfully!`, 'success');
                } else {
                    showMessage('Error: Product not found for update.', 'error');
                }
            } else {
                // CREATE operation (Simulates Product.create())
                const newProduct = Product.create(productData);
                showMessage(`Product "${newProduct.name}" created with ID ${newProduct._id}.`, 'success');
            }

            resetForm();
            renderProducts();
        });


        /** Loads product data into the form for editing. */
        window.handleEdit = function(id) {
            const product = Product.findById(id);
            if (product) {
                document.getElementById('productId').value = product._id;
                document.getElementById('name').value = product.name;
                document.getElementById('price').value = product.price;
                document.getElementById('description').value = product.description;

                // Change form to 'Update' mode
                formTitle.textContent = `Update Product ID: ${product._id}`;
                submitButton.textContent = 'Update Changes';
                submitButton.classList.replace('bg-indigo-600', 'bg-green-600');
                submitButton.classList.replace('hover:bg-indigo-700', 'hover:bg-green-700');
                cancelButton.style.display = 'block';

                // Scroll to form
                document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
            } else {
                showMessage('Error: Product to edit not found.', 'error');
            }
        }

        /** Handles product deletion. */
        window.handleDelete = function(id) {
             // In a real app, this would be a custom modal, but here we simulate the prompt.
             if (confirm(`Are you sure you want to delete Product ID ${id}? This simulates Mongoose's findByIdAndRemove.`)) {
                const deleted = Product.delete(id);
                if (deleted) {
                    showMessage(`Product ID ${id} deleted successfully.`, 'info');
                    renderProducts();
                } else {
                    showMessage('Error: Product not found for deletion.', 'error');
                }
             }
        }

        /** Handles canceling the update operation. */
        cancelButton.addEventListener('click', resetForm);


        // --- 4. Initialization ---

        // Add some initial data to simulate existing products in the database
        Product.create({ name: 'Gemini Advanced Subscription', price: 19.99, description: 'Premium access to the most capable AI models.' });
        Product.create({ name: 'Pixel Watch 3', price: 349.00, description: 'Smartwatch with advanced health tracking features.' });
        Product.create({ name: 'Nest Thermostat v2', price: 129.99, description: 'Smart thermostat for efficient home climate control.' });
        
        // Initial Read operation (R in CRUD)
        window.onload = () => {
            renderProducts();
        };

    </script>
</body>
</html>
